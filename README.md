# ActivityWatch

ActivityWatchは、日々の活動時間を計測し、ラップごとにコメント付きで記録できるシンプルなストップウォッチアプリケーションです。さらに、記録したセッション全体にタイトルとコメントを付けて保存し、後から参照・編集・削除する機能も備えています。Flutterで開発されています。

## 機能

* **ストップウォッチ**:
    * 計測の開始（ログとカウンターをリセットして開始）
    * ラップ記録（カウンターは継続）
    * 計測の停止（最後のラップ記録と同時に停止）
* **時間表示**:
    * 経過時間を `時:分:秒:ミリ秒（下2桁）` 形式で表示します。
* **ラップログ記録**:
    * ラップ記録時に、その時点の経過時間（ラップ終了時間）とコメントを記録します。
    * コメント入力時には、設定可能な候補リストからのサジェスト機能が利用できます（ひらがな入力にも対応）。
    * 記録された現在のラップログは、計測画面下部のテーブルに表示されます。
    * 各ラップログのコメントは後から編集可能です。
* **セッション保存**:
    * 計測停止後、現在のラップログのセット（セッション）にタイトルとコメント（任意）を付けて永続的に保存できます (`shared_preferences` を使用)。
* **履歴表示**:
    * 保存されたセッションを履歴タブで一覧表示します。
    * 一覧は保存日時の降順で表示され、タイトルと保存日時（アイコン付き）が表示されます。
    * 履歴タブが表示されるたびに、一覧は自動的に更新されます。
    * 各セッションをタップすると詳細画面に遷移します。
    * 一覧からセッションを削除できます（確認ダイアログ付き）。
* **セッション詳細表示**:
    * 保存されたセッションのタイトル、コメント（あれば）、保存日時、および含まれる全てのラップログ（開始時間、終了時間、コメント）を表示します。
* **セッション編集**:
    * セッション詳細画面から、保存されたセッションのタイトルとコメントを編集できます。編集内容は永続化され、履歴一覧にも反映されます。
* **データ共有**:
    * 計測画面で記録中のログデータをCSV形式のテキストデータとして、OSの共有機能を使って他のアプリに共有できます。
* **サジェスト設定**:
    * 設定タブで、ラップ記録時のコメント入力サジェスト候補を自由に追加・編集・削除できます。
    * 設定したサジェスト候補は、アプリ内に永続的に保存されます。

## 主な画面構成要素

* **ボトムナビゲーションバー**:
    * **計測タブ**: ストップウォッチ機能と現在のラップログ表示。
    * **履歴タブ**: 保存済みセッションの一覧表示。
    * **設定タブ**: コメントサジェスト候補の管理。
* **計測タブ**:
    * **カウンター**: 現在の経過時間を `HH:MM:SS:ms` 形式で表示。
    * **アクションボタン (右上)**:
        * 保存ボタン (`💾`): 現在のログセッションを保存（計測停止中のみ有効）。
        * 共有ボタン (`<0xE586>`): 現在のログデータをCSV形式で共有（ログがある場合のみ有効）。
    * **ログテーブル**: 現在記録中のラップログを `END`, `COMMENT` の列で表示。各行には編集ボタン (✎) があります。
    * **フローティングアクションボタン (右下)**:
        * 開始ボタン (▶): ログとカウンターをリセットし、新しい計測を開始。
        * ラップ記録ボタン (🚩): カウンターを継続したまま、現在の時間でログ記録ダイアログを表示。
* **履歴タブ**:
    * 保存されたセッションのリスト（タイトル、保存日時）。
    * 各アイテムをタップで詳細画面へ遷移。
    * 削除ボタン (🗑️)。
    * 手動更新ボタン (🔄)。
* **設定タブ**:
    * サジェスト候補の追加、編集、削除インターフェース。

## ログ記録ダイアログ

* **LOGGING TIME**: ラップ記録ボタンを押した時点の時間が表示されます。
* **COMMENT**: 活動内容のメモを入力します（サジェスト機能付き）。
    * 入力時に、ひらがなやカタカナの変換を考慮したサジェスト候補が表示されます。
* **色ラベル選択**: 活動内容に応じた色ラベルを選択可能。
* **終了して記録ボタン (停止アイコン)**: コメントを記録し、カウンターを停止します。
* **保存して記録を続けるボタン (鉛筆アイコン)**: コメントを記録し、カウンターは継続します。
* **ダイアログ外タップ**: 何も記録せずにダイアログを閉じ、カウンターは継続します。

## 技術スタック

* **フレームワーク**: Flutter
* **言語**: Dart
* **主な使用プラグイン**:
    * `share_plus`: OSの共有機能を利用するため。
    * `shared_preferences`: セッションデータ、サジェストリストの永続化のため。
    * `intl`: 日付フォーマットのため。
    * `visibility_detector`: 画面表示検知（履歴の自動更新）のため。

## セットアップと実行

1.  Flutter開発環境がセットアップされていることを確認してください。
2.  このリポジトリをクローンします。
    ```bash
    git clone <repository-url>
    cd activity_watch
    ```
3.  必要なパッケージをインストールします。
    ```bash
    flutter pub get
    ```
4.  接続されているデバイス（エミュレータまたは実機）でアプリケーションを実行します。
    ```bash
    flutter run
    ```

## 更新内容

* **ログ記録ダイアログの改善**:
    * サジェスト機能の強化（ひらがな・カタカナ対応）。
    * 色ラベル選択機能を追加。
    * ダイアログのUIを調整し、使いやすさを向上。
* **コードのリファクタリング**:
    * ダイアログ関連のロジックを共通化し、再利用性を向上。
    * `_buildSharedLogInputFields` 関数を導入して、入力フィールドと色ラベル選択を統一的に管理。

## 今後の拡張予定

* より高度なデータ永続化（`sqflite` や `drift` など）。
* ログデータのフィルタリングや検索機能。
* テーマ設定（ダークモードなど）。
* 外部サービス連携（カレンダー、タスク管理など）。
* 活動時間の可視化（グラフ表示など）。